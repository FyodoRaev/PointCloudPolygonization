[[AutoVectTODO]]
Я попросил задачу с геометрией и Николай Вадимович дал мне задачу с геометрией. Вот её тикет на redmine

-----------------
`Кажется что после того, как будет доступна автоматическая классификация плотного облака будет относительно не сложно реализовать на ее основе векторизацию.`

`В GlobalMapper это реализовано следующим образом (поддерживается векторизация зданий, деревьев и ЛЭП):`  
* [Extract_Vector_Features_tool](http://www.bluemarblegeo.com/knowledgebase/global-mapper-19/Lidar_Module/Lidar_feature_extraction.htm#Extract_Vector_Features_tool)
* [Efficient RANSAC for Point-Cloud Shape Detection](https://www.hinkali.com/Education/PointCloud.pdf)
* [Vadstena: Automatic LOD2 Building Extraction](https://www.melowntech.com/post/2020/08/04/vadstena-lod2-building-extraction.html)  


`любопытный проект в рамках которого решали задачу автоматизированного построения лодов (LoD 2.2/1.3/1.2) из облака точек + footrpint polygon (т.е. видимо из кадастровой карты)`

`[https://github.com/3DBAG/roofer](https://github.com/3DBAG/roofer)`  
`[https://innovation.3dbag.nl/roofer/](https://innovation.3dbag.nl/roofer/)`  
`скриншоты с [https://3dbag.nl/en/viewer](https://3dbag.nl/en/viewer)`

`тот же проект - [https://github.com/tudelft3d/City3D](https://github.com/tudelft3d/City3D)`  
`[https://arxiv.org/pdf/2201.10276](https://arxiv.org/pdf/2201.10276)`  
`прилагаю примеры векторизации отдельных домиков + тайминги сколько каждый из них обрабатывался`

--------


Нужно понять:
* Как я ставлю эксперименты 
	* понять про формат, понять где я работаю чтобы проверять результаты экспериментов, чтобы я мог писать скрипты и они бы могли быстро перекочевать в Metashape без особенных заморочек
* Изучить ссылки в тикете, изучить статьи и найти сопровождающий код.
* Понять что конкретно в нашем контексте most appropriate
* Статьи достаточно широкие, содержательные идеи которые вытекают из этого тикета нужно обосновать, понять перспективы и расписать как это делает Николай Вадимович, сопроводить отправными точками

Попросил LLM пройтись по ссылкам и сделать выжимку [[LLM_VectorizationRoadmap]]

Самое важное оттуда:
* https://github.com/tudelft3d/City3D?tab=readme-ov-file - уже почти всё есть, работает конкретно с форматами PLY (облака точек) и выдает **OBJ** 
	* идея вообще говоря не супер гениальная, понятно что в облаке точек хотим повыделять плоскости, но непонятно как. RANSAC идет в помощь и выбирает самую естесственную плоскость, инженерные улучшения - солверы для поиска плоскостей после первичного отсева RANSAC
* если не хочется убиваться с софтом то можно реально попробовать реализовать сырую версия алгоритму самому, а если в metashape другой формат то переписать будет не так трудно

Там в ГУИ есть параметры
![[Pasted image 20250730130529.png]]
Это прикольно, кажется в контексте конкретно metashape понимание того что такое complexity - это хорошо. Если уметь быстро и деталезированно векторизировать то это может заменить какую то часть построение модели. Условно иметь многополигональную модель здания в некоторых случаях лучше (оказывается есть Poisson surface reconstruction algorithm, там больше похоже на то чего мы хотим, так что эти замечания неактуальны, возможно только если скорость выше) 

----
Читаю статьи PolyFit и City3D, просто хочу разобраться с тем как это работает. 
Сейчас у меня проблемы с подключением к рабочему компу, не хочу ставить софт на ноутбук и тратить время, ведь когда починится подключение к рабочему компу придется заново всё ставить. Там проблема кажется в том что комп выключен или спит, попросил в офисе посмотреть 

---------

Лиза и Леша помогли починить комп так что сейчас поставлю софт и проверю это всё
Нужно еще подоставать из меташейпа каких нибудь облаков точек и поставить софт для чтения ply и obj



------

их гуи симпатичный там могу многое протестировать

 но с ним есть проблемы непонятных логов, вот я запустил пайплайн и программа начала искать плоскости по ранзаку, а по итогу тупо стоит и 0 инфы в логи

нереально медленно работает, просто адски долго
написано в issues что СКИП солвер медленный и стоит попробовать получить лицензию Gurobi  но это всё будет иметь смысл только если ускорение раз в 10, во что я слабо верю

Вообще говоря стоит попробовать посмотреть на решение без солверов вообще а чистый ранзак
```
Yes, the Gurobi teams is quite responsive and helpful.  
Finally, I can run City3D equipped with Gurobi solver.  
And the computation time reduce dramatically to 1/90 of SCIP ones.

Thank you a lot!
```


Проверил гуи и датасет который они предлагают, теперь нужно проверить на наших примерах 

![[Pasted image 20250729174054.png]]

Меташейп уже умеет экспортировать в множестве форматов, достал замок в Йорке

Футпринт оно генерит ужасно автоматически (кадастровую карту)
Плюс на наших примерах (где какое то приличное число точек) работает ужасно долго (с СКИПом)

Вообще говоря иметь футпринт и классифицированное облако точек = решить задачу, дальше там ничего гениального - вопрос в том, реализовано ли уже это или нет внутри меташейп
Иначе же стоит реализовать функционал просто для облака точек который будет искать пересечение плоскостей, при этом возможно допускать дырки. То есть убрать из пайплайна экструзию (вытягивание) стен от футпринта до крыши

Я протестил чистый PolyFit в CGAL и вот эту City3D - они работают на ЦПУ!!! Нужно проресерчить есть ли там вообще прямой реализованный трансфер на ГПУ, если нет то это беда, так как на цпу оно работает ВЕЧНОСТЬ
